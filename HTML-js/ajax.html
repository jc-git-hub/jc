<html><head></head><body><div class="htmledit_views" id="content_views">
    <h1 id="%E4%B8%80%20Ajax%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%8E%9F%E7%90%86"><a name="t0"></a><a name="t0"></a></h1> 
<p id="main-toc"><strong>目录</strong></p> 
<p style="margin-left:0px;"><a href="#t1" target="_self">一 Ajax技术与原理</a></p> 
<p style="margin-left:40px;"><a href="#t2" target="_self">1.1 Ajax简介</a></p> 
<p style="margin-left:40px;"><a href="#t3" target="_self">1.2 Ajax所包含的技术</a></p> 
<p style="margin-left:40px;"><a href="#t4" target="_self">1.3 Ajax的工作原理</a></p> 
<p style="margin-left:40px;"><a href="#t5" target="_self">1.4 XMLHttpRequest 对象的三个常用的属性</a></p> 
<p style="margin-left:80px;"><a href="#t6" target="_self">1. onreadystatechange 属性</a></p> 
<p style="margin-left:80px;"><a href="#t7" target="_self">2. readyState 属性</a></p> 
<p style="margin-left:80px;"><a href="#t8" target="_self">3. responseText 属性</a></p> 
<p style="margin-left:40px;"><a href="#t9" target="_self">1.5 xmlhttprequst的方法</a></p> 
<p style="margin-left:80px;"><a href="#t10" target="_self">1. open() 方法</a></p> 
<p style="margin-left:80px;"><a href="#t11" target="_self">2. send() 方法</a></p> 
<p style="margin-left:0px;"><a href="#t12" target="_self">二 Ajax编程步骤</a></p> 
<p style="margin-left:40px;"><a href="#t13" target="_self">2.1 创建XMLHttpRequest对象</a></p> 
<p style="margin-left:40px;"><a href="#t14" target="_self">2.2 设置请求方式</a></p> 
<p style="margin-left:40px;"><a href="#t15" target="_self">2.3 调用回调函数</a></p> 
<p style="margin-left:40px;"><a href="#t16" target="_self">2.4 发送请求</a></p> 
<p style="margin-left:0px;"><a href="#t17" target="_self">三、应用实例</a></p> 
<hr>
<h1 style="margin-left:0px;"><a name="t1"></a><a name="t1"></a>一 Ajax技术与原理</h1> 
<h2 id="1.1%20Ajax%E7%AE%80%E4%BB%8B"><a name="t2"></a><a name="t2"></a><a name="t1"></a>1.1 Ajax简介</h2> 
<p>AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。</p> 
<p>AJAX 不是新的编程语言，而是一种使用现有标准的新方法。</p> 
<p>AJAX 是与服务器交换数据并更新部分网页的艺术，在不重新加载整个页面的情况下。</p> 
<h2 id="1.2%20Ajax%E6%89%80%E5%8C%85%E5%90%AB%E7%9A%84%E6%8A%80%E6%9C%AF"><a name="t3"></a><a name="t3"></a><a name="t2"></a>1.2 Ajax所包含的技术</h2> 
<p>大家都知道ajax并非一种新的技术，而是几种原有技术的结合体。它由下列技术组合而成。</p> 
<blockquote> 
<p>1.使用CSS和XHTML来表示。</p> 
<p>2. 使用DOM模型来交互和动态显示。</p> 
<p>3.使用XMLHttpRequest来和服务器进行异步通信。</p> 
<p>4.使用javascript来绑定和调用。</p> 
</blockquote> 
<p>AJAX 的核心是 XMLHttpRequest 对象。</p> 
<p>不同的浏览器创建 XMLHttpRequest 对象的方法是有差异的。</p> 
<p><span style="color:#f33b45;"><strong>IE 浏览器使用&nbsp;<em>ActiveXObject</em>，而其他的浏览器使用名为&nbsp;<em>XMLHttpRequest</em>&nbsp;的 JavaScript 内建对象</strong></span></p> 
<h2 id="1.3%20Ajax%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><a name="t4"></a><a name="t4"></a><a name="t3"></a>1.3 Ajax的工作原理</h2> 
<p>Ajax的工作原理相当于在用户和服务器之间加了—个中间层(AJAX引擎)，使用户操作与服务器响应异步化。并不是所有的用户请求都提交给服务器。像—些数据验证和数据处理等都交给Ajax引擎自己来做,，只有确定需要从服务器读取新数据时再由Ajax引擎代为向服务器提交请求。</p> 
<p>来看看和传统方式的区别</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716193059952"></p> 
<p>再来看看它们各自的交互</p> 
<p>浏览器的普通交互方式</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716193857795"></p> 
<p>浏览器的Ajax交互方式</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716193904120"></p> 
<p>在创建Web站点时，在客户端执行屏幕更新为用户提供了很大的灵活性。下面是使用Ajax可以完成的功能：<br> 动态更新购物车的物品总数，无需用户单击Update并等待服务器重新发送整个页面。<br> 提升站点的性能，这是通过减少从服务器下载的数据量而实现的。例如，在Amazon的购物车页面，当更新篮子中的一项物品的数量时，会重新载入整个页面，这必须下载32K的数据。如果使用Ajax计算新的总量，服务器只会返回新的总量值，因此所需的带宽仅为原来的百分之一。<br> 消除了每次用户输入时的页面刷新。例如，在Ajax中，如果用户在分页列表上单击Next，则服务器数据只刷新列表而不是整个页面。<br> 直接编辑表格数据，而不是要求用户导航到新的页面来编辑数据。对于Ajax，当用户单击Edit时，可以将静态表格刷新为内容可编辑的表格。用户单击Done之后，就可以发出一个Ajax请求来更新服务器，并刷新表格，使其包含静态、只读的数据。&nbsp;</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716193102944"></p> 
<h2 id="1.4%20XMLHttpRequest%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%89%E4%B8%AA%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7"><a name="t5"></a><a name="t5"></a><a name="t4"></a>1.4 XMLHttpRequest 对象的三个常用的属性</h2> 
<h3 id="1.%20onreadystatechange%20%E5%B1%9E%E6%80%A7"><a name="t6"></a><a name="t6"></a><strong>1. onreadystatechange 属性</strong></h3> 
<p>onreadystatechange 属性存有处理服务器响应的函数。<br> 下面的代码定义一个空的函数，可同时对 onreadystatechange 属性进行设置：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment">//我们需要在这写一些代码</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<h3 id="2.%20readyState%20%E5%B1%9E%E6%80%A7"><a name="t7"></a><a name="t7"></a><strong>2. readyState 属性</strong></h3> 
<p>readyState 属性存有服务器响应的状态信息。每当 readyState 改变时，onreadystatechange 函数就会被执行。<br> readyState 属性可能的值：</p> 
<div class="table-box"><table style="width:600px;" border="1" cellspacing="1" cellpadding="1"><thead><tr><th style="width:300px;">状态</th><th style="width:700px;">描述</th></tr></thead><tbody><tr><td>0</td><td>请求未初始化（在调用 open() 之前）</td></tr><tr><td>1</td><td>请求已提出（调用 send() 之前）</td></tr><tr><td>2</td><td>请求已发送（这里通常可以从响应得到内容头部）</td></tr><tr><td>3</td><td>请求处理中（响应中通常有部分数据可用，但是服务器还没有完成响应）</td></tr><tr><td>4</td><td>请求已完成（可以访问服务器响应并使用它）</td></tr></tbody></table></div>
<p>我们要向这个 onreadystatechange 函数添加一条 If 语句，来测试我们的响应是否已完成(意味着可获得数据)：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (xmlHttp.readyState == <span class="hljs-number">4</span>) {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//从服务器的response获得数据</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<h3 id="3.%20responseText%20%E5%B1%9E%E6%80%A7"><a name="t8"></a><a name="t8"></a><strong>3. responseText 属性</strong></h3> 
<p>可以通过 responseText 属性来取回由服务器返回的数据。<br> 在我们的代码中，我们将把时间文本框的值设置为等于 responseText：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (xmlHttp.readyState == <span class="hljs-number">4</span>) {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-built_in">document</span>.myForm.time.value = xmlHttp.responseText;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>其它属性如下：</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716190337737"></p> 
<h2 id="1.5%20xmlhttprequst%E7%9A%84%E6%96%B9%E6%B3%95"><a name="t9"></a><a name="t9"></a><a name="t5"></a>1.5 xmlhttprequst的方法</h2> 
<h3 id="1.open()%20%E6%96%B9%E6%B3%95"><a name="t10"></a><a name="t10"></a><strong>1. open() 方法</strong></h3> 
<p>open() 有三个参数。第一个参数定义发送请求所使用的方法，第二个参数规定服务器端脚本的URL，第三个参数规定应当对请求进行异步地处理。</p> 
<pre class="has" name="code"><code class="language-javascript hljs">xmlHttp.open(<span class="hljs-string">"GET"</span>,<span class="hljs-string">"test.php"</span>,<span class="hljs-literal">true</span>);</code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<h3 id="2.send()%20%E6%96%B9%E6%B3%95"><a name="t11"></a><a name="t11"></a><strong>2. send() 方法</strong></h3> 
<p>send() 方法将请求送往服务器。如果我们假设 HTML 文件和 PHP 文件位于相同的目录，那么代码是这样的：</p> 
<pre class="has" name="code"><code class="language-javascript hljs">xmlHttp.send(<span class="hljs-literal">null</span>);</code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>其它方法如下：</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716190353170"></p> 
<h1 id="%E4%BA%8C%20Ajax%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4"><a name="t12"></a><a name="t12"></a><a name="t6"></a>二 Ajax编程步骤</h1> 
<p>为了方便理解，我给AJAX统一了一个流程，要想实现AJAX，就要按照以后步骤走：</p> 
<blockquote> 
<ol><li>创建XMLHttpRequest对象。</li><li>设置请求方式。</li><li>调用回调函数。</li><li>发送请求。</li></ol>
</blockquote> 
<p>下面来看下具体步骤：</p> 
<h2 id="2.1%20%E5%88%9B%E5%BB%BAXMLHttpRequest%E5%AF%B9%E8%B1%A1"><a name="t13"></a><a name="t13"></a><a name="t7"></a>2.1 创建XMLHttpRequest对象</h2> 
<p>创建XMLHttp对象的语法是：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><span class="hljs-keyword">var</span> xmlHttp=<span class="hljs-keyword">new</span> XMLHttpRequest();</code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>如果是IE5或者IE6浏览器，则使用<strong>ActiveX</strong>对象，创建方法是：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><span class="hljs-keyword">var</span> xmlHttp=<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHTTP"</span>);</code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>一般我们手写AJAX的时候，首先要判断该浏览器是否支持XMLHttpRequest对象，如果支持则创建该对象，如果不支持则创建ActiveX对象。JS代码如下：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//第一步：创建XMLHttpRequest对象</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">var</span> xmlHttp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XMLHttpRequest) {            <span class="hljs-comment">//非IE</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    xmlHttp = <span class="hljs-keyword">new</span> XMLHttpRequest();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.ActiveXObject) {       <span class="hljs-comment">//IE</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    xmlHttp = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHTTP"</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<h2 id="2.2%20%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><a name="t14"></a><a name="t14"></a><a name="t8"></a>2.2 设置请求方式</h2> 
<p>在WEB开发中，请求有两种形式，一个是get，一个是post，所以在这里需要设置一下具体使用哪个请求，XMLHttpRequest对象的open()方法就是来设置请求方式的。<br> open()方法</p> 
<div class="table-box"><table style="width:500px;" border="1" cellspacing="1" cellpadding="1"><tbody><tr><td>功能</td><td>　参数</td></tr><tr><td>规定请求的类型、URL 以及是否异步处理请求</td><td>参数1：设置请求类型（GET 或 POST），GET与POST的区别请自己百度一下，这里不做解释；<br> 参数2：文件在服务器上的位置；<br> 参数3：是否异步处理请求，是为true，否为false。</td></tr></tbody></table></div>
<p>如下：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//第二步：设置和服务器端交互的相应参数，向路径http://localhost:8080/JsLearning3/getAjax准备发送数据</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">       </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">var</span> url = <span class="hljs-string">"http://localhost:8080/JsLearning3/getAjax"</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.open(<span class="hljs-string">"POST"</span>, url, <span class="hljs-literal">true</span>);</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>open方法如下：</p> 
<p><img class="has" alt="" src="https://img-blog.csdn.net/20150716185601893"></p> 
<p><strong>GET 还是 POST？</strong><br> 与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。然而，在以下情况中，请使用 POST 请求：</p> 
<blockquote> 
<p>无法使用缓存文件（更新服务器上的文件或数据库）<br> 向服务器发送大量数据（POST 没有数据量限制）<br> 发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</p> 
</blockquote> 
<p><strong>异步 - True 或 False？</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AJAX 指的是异步 JavaScript 和 XML（Asynchronous JavaScript and XML）。XMLHttpRequest 对象如果要用于 AJAX 的话，其 open() 方法的 async 参数必须设置为 true：对于 web 开发人员来说，发送异步请求是一个巨大的进步。很多在服务器执行的任务都相当费时。AJAX 出现之前，这可能会引起应用程序挂起或停止。<br> 通过 AJAX，JavaScript 无需等待服务器的响应，而是：<br> 在等待服务器响应时执行其他脚本<br> 当响应就绪后对响应进行处理</p> 
<h2 id="2.3%20%E8%B0%83%E7%94%A8%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><a name="t15"></a><a name="t15"></a><a name="t9"></a>2.3 调用回调函数</h2> 
<p>如果在上一步中open方法的第三个参数选择的是true，那么当前就是异步请求，这个时候需要写一个回调函数，XMLHttpRequest对象有一个onreadystatechange属性，这个属性返回的是一个匿名的方法，所以回调函数就在这里写xmlHttp.onreadystatechange=function{},function{}内部就是回调函数的内容。所谓回调函数，就是请求在后台处理完，再返回到前台所实现的功能。在这个例子里，我们的回调函数要实现的功能就是接收后台处理后反馈给前台的数据，然后将这个数据显示到指定的div上。因为从后台返回的数据可能是错误的，所以在回调函数中首先要判断后台返回的信息是否正确，如果正确才可以继续执行。代码如下：</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//第三步：注册回调函数</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (xmlHttp.readyState == <span class="hljs-number">4</span>) {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> (xmlHttp.status == <span class="hljs-number">200</span>) {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">document</span>.getElementById(id);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            obj.innerHTML = xmlHttp.responseText;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        } <span class="hljs-keyword">else</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            alert(<span class="hljs-string">"AJAX服务器返回错误！"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>在上面代码中，xmlHttp.readyState是存有XMLHttpRequest 的状态。从 0 到 4 发生变化。0: 请求未初始化。1: 服务器连接已建立。2: 请求已接收。3: 请求处理中。4: 请求已完成，且响应已就绪。所以这里我们判断只有当xmlHttp.readyState为4的时候才可以继续执行。</p> 
<p>xmlHttp.status是服务器返回的结果，其中200代表正确。404代表未找到页面，所以这里我们判断只有当xmlHttp.status等于200的时候才可以继续执行。</p> 
<pre class="has" name="code"><code class="language-Kotlin hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">var</span> obj = document.getElementById(id);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">obj.innerHTML = xmlHttp.responseText;</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>这段代码就是回调函数的核心内容，就是获取后台返回的数据，然后将这个数据赋值给id为testid的div。xmlHttp对象有两个属性都可以获取后台返回的数据，分别是：responseText和responseXML，其中responseText是用来获得<strong>字符串形式</strong>的响应数据，responseXML是用来获得<strong> XML 形式</strong>的响应数据。至于选择哪一个是取决于后台给返回的数据的，这个例子里我们只是显示一条字符串数据所以选择的是responseText。responseXML将会在以后的例子中介绍。</p> 
<p><strong>AJAX状态值与状态码区别</strong><br><strong>&nbsp;<span style="color:#86ca5e;">AJAX状态值是指</span></strong>，运行AJAX所经历过的几种状态，无论访问是否成功都将响应的步骤，可以理解成为AJAX运行步骤。如：正在发送，正在响应等，由AJAX对象与服务器交互时所得；使用“ajax.readyState”获得。（由数字1~4单位数字组成）<br><span style="color:#86ca5e;"><strong>AJAX状态码是指</strong></span>，无论AJAX访问是否成功，由HTTP协议根据所提交的信息，服务器所返回的HTTP头信息代码，该信息使用“ajax.status”所获得；（由数字1XX,2XX三位数字组成，详细查看RFC）<br> 这就是我们在使用AJAX时为什么采用下面的方式判断所获得的信息是否正确的原因。</p> 
<pre class="has" name="code"><code class="language-javascript hljs"><span class="hljs-keyword">if</span>(ajax.readyState == <span class="hljs-number">4</span> &amp;&amp; ajax.status == <span class="hljs-number">200</span>) {。。。。);}</code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p><strong>&nbsp;AJAX运行步骤与状态值说明</strong><br> 在AJAX实际运行当中，对于访问XMLHttpRequest（XHR）时并不是一次完成的，而是分别经历了多种状态后取得的结果，对于这种状态在AJAX中共有5种，分别是：<br> 0 - (未初始化)还没有调用send()方法<br> 1 - (载入)已调用send()方法，正在发送请求<br> 2 - (载入完成)send()方法执行完成，<br> 3 - (交互)正在解析响应内容<br> 4 - (完成)响应内容解析完成，可以在客户端调用了<br> 对于上面的状态，其中“0”状态是在定义后自动具有的状态值，而对于成功访问的状态（得到信息）我们大多数采用“4”进行判断。<br><br><strong>AJAX状态码说明</strong><br> 1**：请求收到，继续处理<br> 2**：操作成功收到，分析、接受<br> 3**：完成此请求必须进一步处理<br> 4**：请求包含一个错误语法或不能完成<br> 5**：服务器执行一个完全有效请求失败</p> 
<p>再具体就如下：</p> 
<p>100——客户必须继续发出请求<br> 101——客户要求服务器根据请求转换HTTP协议版本<br> 200——交易成功<br> 201——提示知道新文件的URL<br> 202——接受和处理、但处理未完成<br> 203——返回信息不确定或不完整<br> 204——请求收到，但返回信息为空<br> 205——服务器完成了请求，用户代理必须复位当前已经浏览过的文件<br> 206——服务器已经完成了部分用户的GET请求<br> 300——请求的资源可在多处得到<br> 301——删除请求数据<br> 302——在其他地址发现了请求数据<br> 303——建议客户访问其他URL或访问方式<br> 304——客户端已经执行了GET，但文件未变化<br> 305——请求的资源必须从服务器指定的地址得到<br> 306——前一版本HTTP中使用的代码，现行版本中不再使用<br> 307——申明请求的资源临时性删除<br> 400——错误请求，如语法错误<br> 401——请求授权失败<br> 402——保留有效ChargeTo头响应<br> 403——请求不允许<br> 404——没有发现文件、查询或URl<br> 405——用户在Request-Line字段定义的方法不允许<br> 406——根据用户发送的Accept拖，请求资源不可访问<br> 407——类似401，用户必须首先在代理服务器上得到授权<br> 408——客户端没有在用户指定的饿时间内完成请求<br> 409——对当前资源状态，请求不能完成<br> 410——服务器上不再有此资源且无进一步的参考地址<br> 411——服务器拒绝用户定义的Content-Length属性请求<br> 412——一个或多个请求头字段在当前请求中错误<br> 413——请求的资源大于服务器允许的大小<br> 414——请求的资源URL长于服务器允许的长度<br> 415——请求资源不支持请求项目格式<br> 416——请求中包含Range请求头字段，在当前请求资源范围内没有range指示值，请求也不包含If-Range请求头字段<br> 417——服务器不满足请求Expect头字段指定的期望值，如果是代理服务器，可能是下一级服务器不能满足请求<br> 500——服务器产生内部错误<br> 501——服务器不支持请求的函数<br> 502——服务器暂时不可用，有时是为了防止发生系统过载<br> 503——服务器过载或暂停维修<br> 504——关口过载，服务器使用另一个关口或服务来响应用户，等待时间设定值较长<br> 505——服务器不支持或拒绝支请求头中指定的HTTP版本</p> 
<h2 id="2.4%20%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><a name="t16"></a><a name="t16"></a><a name="t10"></a>2.4 发送请求</h2> 
<pre class="has" name="code"><code class="language-javascript hljs"><ol class="hljs-ln" style="width:2030px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//第四步：设置发送请求的内容和发送报送。然后发送请求</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">var</span> params = <span class="hljs-string">"userName="</span> + <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">"userName"</span>)[<span class="hljs-number">0</span>].value + <span class="hljs-string">"&amp;userPass="</span> + <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">"userPass"</span>)[<span class="hljs-number">0</span>].value + <span class="hljs-string">"&amp;time="</span> + <span class="hljs-built_in">Math</span>.random();         <span class="hljs-comment">// 增加time随机参数，防止读取缓存 				</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.setRequestHeader(<span class="hljs-string">"Content-type"</span>, <span class="hljs-string">"application/x-www-form-urlencoded;charset=UTF-8"</span>);                     <span class="hljs-comment">// 向请求添加 HTTP 头，POST如果有数据一定加加！！！！</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlHttp.send(params);</div></div></li></ol></code><div class="hljs-button {2}" onclick="hljs.copyCode(event)" data-title="复制" data-report-click='{"spm":"1001.2101.3001.4259"}'></div></pre> 
<p>如果需要像 HTML 表单那样 POST 数据，请使用 setRequestHeader() 来添加 HTTP 头。然后在 send() 方法中规定您希望发送的数据。</p> 
<h1 id="%E4%B8%89%E3%80%81%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><a name="t17"></a><a name="t17"></a><a name="t11"></a>三、应用实例</h1> 
<p>&nbsp;</p>
</div></body></html>